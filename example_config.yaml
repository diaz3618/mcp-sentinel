# MCP Sentinel — Example Configuration
# Copy this file to config.yaml and edit to match your setup.
# Documentation: docs/configuration.md
#
# Supported formats: YAML (.yaml, .yml)
# Environment variables: use ${VAR_NAME} syntax for expansion
# Secret references: use secret:my-key to resolve from the secret store

version: "1"

# ── Server Settings ──────────────────────────────────────────────────────
server:
  host: "127.0.0.1"
  port: 9000
  transport: streamable-http         # "sse" or "streamable-http"
  management:
    enabled: true
    token: "${SENTINEL_MGMT_TOKEN}" # Bearer token for /manage/v1/ endpoints

# ── Client / TUI Settings ────────────────────────────────────────────────
# Settings used by ``mcp-sentinel tui`` and _dev_launch.py.
# CLI flags take precedence over these values.
client:
  server_url: "http://127.0.0.1:9000"  # Sentinel server URL the TUI connects to
  # token: "${SENTINEL_MGMT_TOKEN}"    # Bearer token for management API
  theme: "textual-dark"                 # Default TUI theme
  poll_interval: 2.0                    # Status polling interval (seconds, 0.5–60)
  # servers_config: "~/.config/mcp-sentinel/servers.json"  # Multi-server config

# ── Backend MCP Servers ──────────────────────────────────────────────────
backends:
  # Stdio backend — launches a local process
  stdio_test:
    type: stdio
    command: python
    args:
      - mods/stdio_test_server.py
    env:
      PYTHONUNBUFFERED: "1"
    group: default                  # logical server group
    timeouts:
      init: 15                      # MCP session init timeout (seconds)
      cap_fetch: 10                 # capability fetch timeout
    filters:
      tools:
        allow: ["*"]                # glob patterns
        deny: []
      resources:
        allow: ["*"]
        deny: []
    tool_overrides:
      original_tool_name:
        name: renamed_tool          # client-facing name
        description: "Override description"

  # SSE backend — connects to a running SSE endpoint
  sse_test:
    type: sse
    url: "http://127.0.0.1:8021/mcp_sse"
    command: python                 # optional: launch the server process
    args:
      - mods/sse_test_server.py
    env:
      PYTHONUNBUFFERED: "1"
    headers:                        # extra HTTP headers
      X-Custom-Header: "value"
    # auth:                         # outgoing authentication (optional)
    #   type: oauth2
    #   token_url: "https://auth.example.com/token"
    #   client_id: "${OAUTH_CLIENT_ID}"
    #   client_secret: "${OAUTH_CLIENT_SECRET}"
    #   scopes: ["mcp:read", "mcp:write"]

  # Streamable HTTP backend
  # remote_server:
  #   type: streamable-http
  #   url: "https://mcp.example.com/mcp"
  #   headers:
  #     Authorization: "Bearer ${API_TOKEN}"

# ── Conflict Resolution ─────────────────────────────────────────────────
conflict_resolution:
  strategy: first-wins              # "first-wins", "prefix", "priority", "error"
  separator: "_"                    # for prefix strategy: "server_tool"
  order: []                         # priority list for "priority" strategy

# ── Audit Logging ────────────────────────────────────────────────────────
audit:
  enabled: true
  file: "logs/audit.jsonl"
  max_size_mb: 100
  backup_count: 5

# ── Tool Optimizer ───────────────────────────────────────────────────────
optimizer:
  enabled: false                    # replaces full tool list with find_tool + call_tool
  keep_tools: []                    # tools always exposed alongside meta-tools

# ── Telemetry (OpenTelemetry) ────────────────────────────────────────────
telemetry:
  enabled: false                    # enable OTel tracing and metrics
  otlp_endpoint: "http://localhost:4317"  # OTLP collector endpoint
  service_name: "mcp-sentinel"      # service name in traces

# ── Secrets Management ───────────────────────────────────────────────────
secrets:
  enabled: false                    # enable automatic secret resolution
  provider: env                     # "env", "file", or "keyring"
  path: ""                          # path for file provider (ignored otherwise)
  strict: false                     # error if secret cannot be resolved

# ── Registries ───────────────────────────────────────────────────────────
# External catalogs of MCP servers for the TUI Registry browser.
# Configure at least one to use the Registry feature (browse & install).
# Nothing is included by default — add the registries you want to use.
#
# See docs/registry/README.md for the full list of public registries and
# instructions on running your own.
registries:
  # - name: community
  #   url: "https://glama.ai/api/mcp"       # 17,800+ servers
  #   priority: 100                           # lower = checked first
  #   auth: none
  #
  # - name: smithery
  #   url: "https://registry.smithery.ai"    # 4,500+ MCPs
  #   priority: 200
  #   auth: none
  #
  # - name: internal
  #   url: "https://registry.corp.example.com/v0/servers"
  #   priority: 50
  #   auth: api-key
  #   api_key_env: INTERNAL_REGISTRY_KEY     # reads from env var

# ── Incoming Authentication ──────────────────────────────────────────────
incoming_auth:
  type: anonymous                   # "anonymous", "local", "jwt", "oidc"
  # token: "${MCP_AUTH_TOKEN}"      # for "local" type
  # jwks_uri: "https://..."        # for "jwt" type
  # issuer: "https://..."          # for "jwt"/"oidc" type
  # audience: "mcp-sentinel"       # expected JWT audience
  # algorithms: ["RS256", "ES256"]

# ── Authorization (RBAC) ────────────────────────────────────────────────
authorization:
  enabled: false
  default_effect: deny              # "allow" or "deny" when no policy matches
  policies:
    - effect: allow
      roles: ["admin"]
      resources: ["*"]
    # - effect: deny
    #   roles: ["viewer"]
    #   resources: ["tool:dangerous_*"]

# ── Feature Flags ────────────────────────────────────────────────────────
# See config/flags.py for all recognized flags and their defaults.
feature_flags:
  hot_reload: true                  # default: true
  optimizer: false                  # default: false
  # outgoing_auth: true             # default: true
  # session_management: true        # default: true
  # yaml_config: true               # default: true
